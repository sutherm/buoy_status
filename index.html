<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLOS Buoy Status</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
	<script src="https://unpkg.com/leaflet-simple-map-screenshoter"></script>
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
        }
        
        .header {
            background: #3d529b; <!-- linear-gradient(270deg, #4898b9 0%, #3d529b 50%); -->
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
		.header-content {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 1rem;
		}

		.header-logo {
			height: 4rem;
			width: auto;
		}

		.header-text h1,
		.header-text p {
			text-align: center;
		}
		
		
		
        .header h1 {
			color: #f5f5f5;
			text-align: center;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #f5f5f5;
			text-align: center;
			opacity: 0.9;
            font-size: 0.85rem;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            padding: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .panel-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            color: #495057;
        }
        
        #map {
            height: 550px;
            width: 100%;
        }
        
        .table-container {
            padding: 1.5rem;
            max-height: 550px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f9fa;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
        }
        
		th.asc::after {
			content: " ▲";
			font-size: 0.75rem;
		}
		
		th.desc::after {
			content: " ▼";
			font-size: 0.75rem;
		}
		
        td {
            padding: 0.75rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        tr:hover {
            background: #FB8500;
            cursor: pointer;
			opacity: 0.5
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 1.5rem;
        }
        
        .stat-card {
            background: #4898b9; <!-- linear-gradient(270deg, #4898b9 1%, #3d529b 100%); -->
            color: white;
            padding: 1.25rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-value {
			color: #f5f5f5;
			text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.3rem;
        }
        
        .stat-label {
            color: #f5f5f5;
			text-align: center;
			opacity: 0.9;
            font-size: 0.9rem;
        }
        		
		.legend {
			background: white;
			border-radius: 8px;
			box-shadow: 0 2px 6px rgba(0,0,0,0.25);
			font-size: 0.75rem;
			color: #333;
			overflow: hidden;
			transition: all 0.3s ease;
			width: 100px;
		}

		.legend-header {
			background: #3d529b;
			color: white;
			padding: 6px 10px;
			cursor: pointer;
			user-select: none;
			font-size: 0.75rem;
		}

		.legend-body {
			display: flex;
			flex-direction: column;
			gap: 10px;
			padding: 10px;
		}

		.legend-item {
			display: flex;
			align-items: center;
			gap: 8px;
			cursor: pointer;
			transition: all 0.2s ease;
			padding: 4px 0;
		}

		.legend-item:hover {
			opacity: 0.5;
		}

		.legend-header:hover {
			background: #4898b9;
		}

		.legend-circle {
			width: 14px;
			height: 14px;
			border-radius: 50%;
			border: 1px solid #ccc;
		}

		.legend.collapsed .legend-body {
			display: none;
		}

		.legend-item.off {
			opacity: 0.3;
		}
		
        @media (max-width: 968px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
	<div class="header">
		<div class="header-content">
			<img src="https://glos.org/wp-content/uploads/2022/12/Logo_Color_Mark-Only.png" alt="GLOS Logo" class="header-logo">
			<div class="header-text">
				<h1>GLOS Buoy Status</h1>
				<p>Updated weekly; Status as of 11-11-2025</p>
			</div>
		</div>
	</div>
	
    <!-- <div class="header">
        <h1>GLOS Buoy Status</h1>
        <p>Updated weekly; Status as of mm-dd-2025</p>
    </div> -->
    
    <div class="container">
        <div class="panel">
            <!-- <div class="panel-header">GLOS-Supported Buoys</div> -->
            <div id="map"></div>
        </div>
        
        <div class="panel">
            <div class="panel-header">GLOS Supported Buoys</div>
            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>Buoy ID</th>
                            <th>Name</th>
							<th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="panel" style="grid-column: 1 / -1;">
            <!-- <div class="panel-header">Summary Statistics</div> -->
            <div class="stats" id="statsContainer">
            </div>
        </div>
    </div>

    <script>
        // Sample data - replace with your own
		let locations = [];

		fetch("data/buoys.json")
  			.then(response => response.json())
  			.then(data => {
      			locations = data;
      			initMapData(); // <-- call a function to build markers/table/etc.
  			})
  			.catch(err => {
      			console.error("Failed to load JSON:", err);
  			});

		// Initialize map
        function initMapData() {
			const map = L.map('map').setView([45, -84.5], 6);
			
			L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
				subdomains: 'abcd', 
				maxZoom: 20}).addTo(map); 
			
			L.control.fullscreen({
				position: 'topright',
				title: 'View Fullscreen',
				titleCancel: 'Exit Fullscreen'
				}).addTo(map);
			
			L.simpleMapScreenshoter().addTo(map)
			
	        // Add markers
			const markers = {};
			const activeGroup = L.layerGroup().addTo(map);
			const inactiveGroup = L.layerGroup().addTo(map);
	
			locations.forEach(loc => {
				const isActive = loc.status.toLowerCase() === "active";
				const color = isActive ? "#23e100" : "#434b4d";
				const radius = isActive ? 6 : 3.5;
	
				const marker = L.circleMarker([loc.lat, loc.lng], {
					radius: radius,
					color: "#ffffff",
					weight: 1,
					fillColor: color,
					fillOpacity: 0.9
				})
			
			.bindPopup(`<b>${loc.buoy}</b><br>${loc.name}<br>Status: ${loc.status}`);
	
			(isActive ? activeGroup : inactiveGroup).addLayer(marker);
	
			markers[loc.buoy] = marker;
			});
				
	        // Populate table
	        const tableBody = document.getElementById('tableBody');
	        locations.forEach(loc => {
	            const row = document.createElement('tr');
	            row.innerHTML = `
	                <td>${loc.buoy}</td>
	                <td>${loc.name}</td>
	                <td>${loc.status}</td>
	            `;
	            row.addEventListener('click', () => {
	                markers[loc.buoy].openPopup();
	                map.setView([loc.lat, loc.lng], 10);
	            });
	            tableBody.appendChild(row);
	        });
	
	        // Calculate and display stats
	        const totalValue = locations.reduce((sum, loc) => sum + loc.value, 0);
	        const avgValue = totalValue / locations.length;
	        const activeCount = locations.filter(loc => loc.status === 'active').length;
	
	        const statsContainer = document.getElementById('statsContainer');
	        const stats = [
	            { label: 'Total Buoys', value: locations.length },
	            { label: 'Active Buoys', value: activeCount }
				<!-- { label: 'Total Value', value: totalValue.toLocaleString() }, -->
	            <!-- { label: 'Buoy Status Changes', value: Math.round(avgValue).toLocaleString() } -->
	        ];
	
	        stats.forEach(stat => {
	            const card = document.createElement('div');
	            card.className = 'stat-card';
	            card.innerHTML = `
	                <div class="stat-value">${stat.value}</div>
	                <div class="stat-label">${stat.label}</div>
	            `;
	            statsContainer.appendChild(card);
	        });
			
			// Legend code
			const legend = L.control({ position: "bottomleft" });
			legend.onAdd = function (map) {
				const div = L.DomUtil.create("div", "info legend");
	
				// Start collapsed on mobile
				if (window.innerWidth < 768) {
					div.classList.add("collapsed");
				}
	
				div.innerHTML = `
					<div class="legend-header">
						<strong>Legend ▸</strong>
					</div>
	
					<div class="legend-body">
						<div class="legend-item legend-active" data-layer="active">
							<span class="legend-circle" style="background:#23e100;"></span>
							<span>Active</span>
						</div>
	
						<div class="legend-item legend-inactive" data-layer="inactive">
							<span class="legend-circle" style="background:#434b4d;"></span>
							<span>Inactive</span>
						</div>
					</div>
				`;
	
				// Toggle collapse
				const header = div.querySelector(".legend-header");
				header.addEventListener("click", () => {
					div.classList.toggle("collapsed");
					header.querySelector("strong").textContent =
					  div.classList.contains("collapsed") ? "Legend ▸" : "Legend ▾";
				});
	
				// Toggle active/inactive layer visibility
				div.querySelectorAll(".legend-item").forEach(item => {
					item.addEventListener("click", () => {
						const type = item.dataset.layer;
						const group = type === "active" ? activeGroup : inactiveGroup;
	
						if (map.hasLayer(group)) {
							map.removeLayer(group);
							item.classList.add("off");
						} else {
							map.addLayer(group);
							item.classList.remove("off");
						}
					});
				});
	
				L.DomEvent.disableClickPropagation(div);
				return div;
			};
	
			legend.addTo(map);
		}
    </script>
	<script>
    // Enable column sorting
    document.querySelectorAll("#dataTable th").forEach((header, columnIndex) => {
        header.style.cursor = "pointer";
        header.addEventListener("click", () => {
            const table = header.closest("table");
            const tbody = table.querySelector("tbody");
            const rows = Array.from(tbody.querySelectorAll("tr"));
            
            const isAscending = header.classList.toggle("asc"); // toggle class each click
            header.classList.toggle("desc", !isAscending);

            // Remove sorting classes from other headers
            table.querySelectorAll("th").forEach(th => {
                if (th !== header) th.classList.remove("asc", "desc");
            });

            // Sort rows
            const sortedRows = rows.sort((a, b) => {
                const aText = a.children[columnIndex].textContent.trim();
                const bText = b.children[columnIndex].textContent.trim();

                // Check if numeric sort makes sense
                const aNum = parseFloat(aText.replace(/[^0-9.-]+/g,""));
                const bNum = parseFloat(bText.replace(/[^0-9.-]+/g,""));
                const bothNumeric = !isNaN(aNum) && !isNaN(bNum);

                if (bothNumeric) {
                    return isAscending ? aNum - bNum : bNum - aNum;
                } else {
                    return isAscending
                        ? aText.localeCompare(bText)
                        : bText.localeCompare(aText);
                }
            });

            // Rebuild table
            tbody.innerHTML = "";
            sortedRows.forEach(row => tbody.appendChild(row));
        });
    });
	</script>
</body>
</html>
